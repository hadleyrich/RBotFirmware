<!-- RBotFirmware CNC Control
        by Rob Dobson (c) 2017..2019
        MIT license
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="description" content="WebUI for RBotFirmware CNC">
    <meta name="author" content="Rob Dobson">

    <title id="title">RBot</title>
    <link rel="shortcut icon" type="image/x-icon" href="data:image/x-icon;,">
    <script>
        const favIconRobotOne = 
            "iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAdgAAAHYBTnsmCAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGXSURBVDiNjdO7a5RREAXw3/12iY+AFoIuvhBc2BUxjcFCCNiIdUAbxUILq4CdhUlINA/0T7CwUwKaQhAEo4WYKoWVhGQtIqKFgo/CFOJudiySkH18Qk43M+ecmTv33iQHtVEDkcyksFAPP4qZweD6ibued3KzPINIbuLQtRkP+iatYEcWbuRxi3lJfInw+uFlp1P4FWFBZiWPmFqDxXGlQtEYznfWEHhVT8ZPDfvWZbB4z9FCwwJK/5lqE1+LnCmP+EzLDgp1Q9sQQ6nB0GawtcTk5DbE69Sk3G3Acfzdhv53hP1tBvFEAceEK5Kr+Jkj/J7CIG7RYbD0wWFkhTVz1WGPhBc5BrOVUc9S07sug0R/4lOZ1Y3kNBot4tViwxho+oi9S9P2bRmEPc3wuLZL7/K4g2thN+as333gbT1z5P2UA1HQF0wI/RvN27E86SUG8KejtBPz1REXWpO5Tzkl9yvD7rTmalPGIpzt5OZ9pp5YP0IboqkXPV3N2safcFHyFM2UOVe5bR5q0wai6Q0y4VJ11Oym5h/yvXgfXMadWAAAAABJRU5ErkJggg=="

        // Embedded favicon technique https://stackoverflow.com/questions/5199902
        const docHead = document.getElementsByTagName('head')[0];
        const newLink = document.createElement('link');
        newLink.rel = 'shortcut icon';
        newLink.type = 'image/x-icon';
        newLink.href = 'data:image/png;base64,' + favIconRobotOne;
        docHead.appendChild(newLink);

        function bodyIsLoaded()
        {
            console.log("Body loaded");
            // Location for program data
            window.pageState = {
                fileToStream: null,
                streamingInProgress: false,
                MAX_POST_CHUNK_SIZE: 1000,
                STREAMING_RETRY_TIME_MS: 1000,
                MAX_STREAM_GCODE_RETRIES: 180,
                MAX_FILE_SIZE: 2000000,
                MAX_CONFIG_LEN: 2000,
                axisNames: ["X", "Y", "Z"],
                endstopNames: ["min", "max"],
                robotTypes: [],
                settings: {},
                isConnected: false,
                updateFilesIndex: 0,
                curFileList: [],
                fileDialogType: "filesystem",
                uploadProgress: [],
                latestfileListInfo: {},
                fileSystemBasePath: "",
                lastStatusRxTime: new Date(),
                statusUpdateCheckMs: 2000,
				statusUpdateTooLateMs: 15000
            };
            // Handle the file send box listener
            const inputFileUpload = document.getElementById("input_file_upload");
            inputFileUpload.addEventListener('change', fileUploadChange, false);
            // Handle enter in the gcode box
            const gcodeSendBox = document.getElementById("gcodeSendBox");
            gcodeSendBox.addEventListener('keypress', keyPressInGCodeBox, false);
            // Get settings
            callAjax("/getsettings", settingsCallback);
            callAjax("/getRobotTypes", robotTypesCallback);
            // Request file list to display
            fileListUpdate();
            // Connect events
            connectEvents();
            // Status update check
            setInterval(statusUpdateTimerHandler, window.pageState.statusUpdateCheckMs);
            // Get status
            setTimeout(getStatus, 100);
        }
        function getStatus()
        {
            callAjax("/status", statusCallback);
        }
		function statusUpdateTimerHandler()
		{
			let nowTime = new Date();
			if (nowTime - window.pageState.lastStatusRxTime > window.pageState.statusUpdateTooLateMs)
			{
                let connButton = document.getElementById("button-connect");
                connButton.disabled = false;
                connButton.classList.remove("disabled");
			}
		}
        function statusCallback(resp)
        {
            // Now connected
            window.pageState.isConnected = true;
            const connButton = document.getElementById("button-connect");
            connButton.disabled = true;
            connButton.classList.add("disabled");
            window.pageState.lastStatusRxTime = new Date();
            // Parse status received
            let machineStatus = {};
            try {
                machineStatus = JSON.parse(resp);
            }
            catch(e)
            {
                console.error("Failed to parse status JSON");
            }
            const axisNames = window.pageState.axisNames;
            const endstopNames = window.pageState.endstopNames;
            if (machineStatus.hasOwnProperty("XYZ"))
            {
                for (let i = 0; i < axisNames.length; i++)
                {
                    document.getElementById("td_" + axisNames[i]).innerHTML = machineStatus["XYZ"][i].toFixed(2);
                }
            }
            if (machineStatus.hasOwnProperty("ABC"))
            {
                for (let i = 0; i < axisNames.length; i++)
                {
                    document.getElementById("td_step" + axisNames[i]).innerHTML = machineStatus["ABC"][i];
                }
            }
            if (machineStatus.hasOwnProperty("end"))
            {
                for (let i = 0; i < axisNames.length; i++)
                {
                    for (let j = 0; j < endstopNames.length; j++)
                    {
                        let endstopState = machineStatus["end"][i][j];
                        let endstopStr = "n/a";
                        if (endstopState === 1)
                            endstopStr = "HIT";
                        if (endstopState === 2)
                            endstopStr = "";
                        document.getElementById("td_" + endstopNames[j] + axisNames[i]).innerHTML = endstopStr;
                    }
                }
            }
            if (machineStatus.hasOwnProperty("pause"))
            {
                document.getElementById("td_robotState").innerHTML = (machineStatus.pause ? "Paused" : "Running");
            }
            if (machineStatus.hasOwnProperty("Qd"))
            {
                document.getElementById("td_robotQueueLen").innerHTML = machineStatus.Qd;
            }
        }

        function robotTypesCallback(resp)
        {
            // Store robot types
            window.pageState.robotTypes = JSON.parse(resp);
            // Add the robot types to list
            const selec = document.getElementById('td_RobotTypeSelect');
            selec.innerHTML = "";
            for (let i = 0; i < window.pageState.robotTypes.length; i++)
            {
                opt = document.createElement('option');
                opt.innerHTML = window.pageState.robotTypes[i];
                opt.value = window.pageState.robotTypes[i];
                selec.appendChild(opt);
                if (window.pageState.settings.hasOwnProperty("robotConfig") && 
                            window.pageState.settings.robotConfig.hasOwnProperty("robotType"))
                    if (window.pageState.settings.robotConfig.robotType === opt.value)
                        selec.value = opt.value;
            }            
        }

        function showSettings()
        {
            // Settings
            let robotTypeSelSet = false;
            const settings = window.pageState.settings;
            if (settings.hasOwnProperty("robotConfig"))
            {
                document.getElementById("td_RobotConfig_input").readOnly = false;
                document.getElementById("td_RobotConfig_input").value = JSON.stringify(settings["robotConfig"]);
                // Robot type
                if (settings.robotConfig.hasOwnProperty("robotType"))
                {
                    let robotType = settings.robotConfig["robotType"];
                    for (let i = 0; i < window.pageState.robotTypes.length; i++)
                    {
                        if (window.pageState.robotTypes[i] === robotType)
                        {
                            document.getElementById('td_RobotTypeSelect').setAttribute("selected", robotType);
                            robotTypeSelSet = true;
                            break;
                        }
                    }
                }
            }
            if ((!robotTypeSelSet) && (window.pageState.robotTypes.length != 0))
                document.getElementById('td_RobotTypeSelect').setAttribute("selected", window.pageState.robotTypes[0]);

            // Name            
            if (settings.hasOwnProperty("name"))
            {
                document.getElementById("td_RobotName_input").value = settings["name"];
            }

            // Command Schedule
            if (settings.hasOwnProperty("cmdSched"))
            {
                document.getElementById("td_CmdSchedule_input").value = JSON.stringify(settings["cmdSched"]);
            }
            else
            {
                document.getElementById("td_CmdSchedule_input").value = JSON.stringify({jobs:[]});
            }

            // Chack strings valid
            checkJsonStrings(false);
        }

        function settingsCallback(resp)
        {
            window.pageState.settings = JSON.parse(resp);
            // Show current settings
            showSettings();
        }

        function checkJsonStrings(validateJsonToo)
        {
            if (validateJsonToo)
            {
                // Validate JSON
                try
                {
                    window.pageState.settings.robotConfig = JSON.parse(document.getElementById('td_RobotConfig_input').value);
                    if (document.getElementById('td_CmdSchedule_input').value.length != 0)
                        window.pageState.settings.cmdSched = JSON.parse(document.getElementById('td_CmdSchedule_input').value);
                    else
                        window.pageState.settings.cmdSched = {jobs:[]};
                }
                catch (e)
                {
                    return false;
                }
            }
            return true;
        }

        function saveConfig()
        {
            console.log("Save Settings");
            // Pull together the config
            if (!checkJsonStrings(true))
            {
                alert("Settings JSON is not valid - please check");
                return;
            }
            // Robot name
            window.pageState.settings.name = document.getElementById('td_RobotName_input').value;
            // Check valid and remove extraneous values
            const configStr = window.pageState.settings;
            // Check length of config string
            if (JSON.stringify(configStr).length > window.pageState.MAX_CONFIG_LEN)
            {
                alert("Settings JSON is too long for EEPROM (max " + window.pageState.MAX_CONFIG_LEN + ") please shorten");
            }
            else
            {
                console.log("Sending config str" + JSON.stringify(configStr));
                postJson("/postsettings/", JSON.stringify(configStr), postSettingsOkCallback, postSettingsFailCallback);
            }
        }

        function postSettingsOkCallback()
        {
            console.log("Settings sent ok");
        }

        function postSettingsFailCallback()
        {
            alert("Failed to send new settings");
        }

        function robotTypeClick()
        {
            const selIdx = document.getElementById('td_RobotTypeSelect').selectedIndex;
            const selType = document.getElementById('td_RobotTypeSelect').options[selIdx];
            console.log("Change robot type " + selType.text);
            callAjax("/getRobotConfiguration/" + selType.text, gotRobotTypeConfig);
        }

        function gotRobotTypeConfig(resp)
        {
            window.pageState.settings["robotConfig"] = JSON.parse(resp);
            showSettings()
        }

        function callAjax(url, okCallback, failCallback)
        {
            let xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function()
            {
                if (xmlhttp.readyState === 4)
                {
                    if (xmlhttp.status === 200)
                    {
                        if ((okCallback !== undefined) && (typeof okCallback !== 'undefined'))
                            okCallback(xmlhttp.responseText);
                    }
                    else
                    {
                        if ((failCallback !== undefined) && (typeof failCallback !== 'undefined'))
                            failCallback(xmlhttp);
                    }
                }
            };

            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }

        function ajaxCallback()
        {
            console.log("AjaxCallback");
        }

        function postJson(url, jsonStrToPos, okCallback, failCallback)
        {
            let xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function()
            {
                if (xmlhttp.readyState === 4)
                {
                    if (xmlhttp.status === 200)
                    {
                        if ((okCallback !== undefined) && (typeof okCallback !== 'undefined'))
                            okCallback(xmlhttp.responseText);
                    }
                    else
                    {
                        if ((failCallback !== undefined) && (typeof failCallback !== 'undefined'))
                            failCallback(xmlhttp);
                    }
                }
            };
            xmlhttp.open("POST", url);
            xmlhttp.setRequestHeader("Content-Type", "application/json");
            xmlhttp.send(jsonStrToPos);
        }

        function sendGcodeFromInput()
        {
            const gcode = document.getElementById('gcodeSendBox').value;
            if (gcode.length !== 0)
            {
                callAjax('/exec/' + gcode, ajaxCallback);
            }
        }

        function connectEvents()
        {
            // Setup async events (text-only messages pushed to browser)
            if (!!window.EventSource) {
                let source = new EventSource('/events');
                // Events on async event source
                source.addEventListener('open', function(e) {
                    console.log("Async events connected");
                }, false);
                source.addEventListener('error', function(e) {
                    if (e.target.readyState != EventSource.OPEN) {
                        console.log("Events Disconnected");
                    }
                }, false);
                source.addEventListener('status', function(e) {
                    console.log("status", e.data);
                    statusCallback(e.data);
                }, false);
            }
        }
        function reconnect(event)
        {
            connectEvents();
        }

        function pauseRobot(event)
        {
            callAjax("/exec/pause");
        }

        function resumeRobot(event)
        {
            callAjax("/exec/resume");
        }

        function stopRobot()
        {
            callAjax("/exec/stop");
            setStreamGCodeState(false);
            streamGCodeShowStatus("Cancelled");
        }

        function moveClick(axis, dist)
        {
            const axisNames = window.pageState.axisNames;
            // Set relative positioning and restore to absolute afterwards
            streamGCodeImmediate("G91\nG0 " + axisNames[axis].toUpperCase() + dist.toString() + "\nG90", false);
        }

        function goHomeClick(axis)
        {
            if (axis == -1)
            {
                callAjax("/exec/G28");
            }
            else
            {
                const axisNames = window.pageState.axisNames;
                callAjax("/exec/G28 " + axisNames[axis].toUpperCase());
            }
        }

        function setHomeClick(axis)
        {
            const axisNames = window.pageState.axisNames;
            callAjax("/exec/G92 " + axisNames[axis].toUpperCase());
        }

        function fileUploadChange(e)
        {
            if (this.files.length > 0)
            {
                if (window.pageState.fileDialogType === "filesystem")
                    startFileSystemUpload(this.files);
                else
                    startGCodeStream(this.files[0])
                const inputFileUpload = document.getElementById("input_file_upload");
                inputFileUpload.value = ""
            }
        }

        function btnStreamGcode(e)
        {
            // See if streaming in progress
            if (window.pageState.streamingInProgress)
            {
                alert("Streaming in progress");
                return;
            }
            window.pageState.fileDialogType = "streamgcode";
            const inputFileUpload = document.getElementById("input_file_upload");
            inputFileUpload.click();
            e.preventDefault();
        }

        function btnStreamGCodeCancel(e)
        {
            clearTimeout(window.pageState.streamGCodeRetryTimer);
            callAjax("/exec/stop");
            setStreamGCodeState(false);
            streamGCodeShowStatus("Cancelled");
            e.preventDefault();
        }

        function keyPressInGCodeBox(event)
        {
            if ((event.keyCode === 13) || (event.which === 13))
            {
                sendGcodeFromInput();
            }
        }

        function streamGCodeShowStatus(statusStr)
        {
            const txtUploadStatus = document.getElementById("txtUploadStatus");
            txtUploadStatus.textContent = statusStr;
        }

        function setStreamGCodeState(streamingInProgress)
        {
            window.pageState.streamingInProgress = streamingInProgress;
            const btnStreamGCode = document.getElementById("btnStreamGCode");
            if (streamingInProgress)
                btnStreamGCode.classList.add("disabled");
            else
                btnStreamGCode.classList.remove("disabled");
            const btnStreamGCodeCancel = document.getElementById("btnStreamGCodeCancel");
            if (!streamingInProgress)
            {
                btnStreamGCodeCancel.classList.add("disabled");
                btnStreamGCodeCancel.disabled = true;
            }
            else
            {
                btnStreamGCodeCancel.classList.remove("disabled"); 
                btnStreamGCodeCancel.disabled = false;
            }
        }

        function startGCodeStream(fileToStream)
        {
            // See if streaming in progress
            if (window.pageState.streamingInProgress)
            {
                console.log("Streaming already in progress");
                return;
            }
            // Check if the file is within bounds
            if (fileToStream.size > window.pageState.MAX_FILE_SIZE)
            {
                alert("Stream file is too large");
                return;
            }
            // Setup a new stream
            window.pageState.fileToStream = fileToStream;
            window.pageState.fileToStreamStartTime = new Date();
            window.pageState.streamGcodeLines = [];
            window.pageState.streamGcodeCurLine = 0;
            window.pageState.streamGcodeRetryCount = 0;
            // Set status
            setStreamGCodeState(true);
            // Show status
            streamGCodeShowStatus("Streaming " + window.pageState.fileToStream.name);
            // Read the file and start sending
            streamGCodeReadFile().then(streamGCodeLines, streamGCodeReadFailed);
        }

        function streamGCodeImmediate(dataToSend, warnIfBusy=true)
        {
            // Check if already streaming
            if (window.pageState.streamingInProgress)
            {
                if (warnIfBusy)
                    alert("Upload in progress");
                return;
            }
            window.pageState.streamingInProgress = true;
            streamGCodeLines(dataToSend);
        }
        function streamGCodeLines(dataToSend)
        {
            // Split file into lines
            window.pageState.streamGcodeLines = dataToSend.toString().split("\n");
            window.pageState.streamGcodeCurLine = 0;
            window.pageState.streamGcodeRetryCount = 0;
            streamGCodeSendNextChunk();
            // console.log("Success");

        }

        function streamGCodeReadFailed(err)
        {
            setStreamGCodeState(false);
            streamGCodeShowStatus("Failed to stream file" + err)
        }

        function gCodeCheckFileValid(inData)
        {
            for (let i = 0; i < inData.length && i < 1000; i++)
            {
                if (inData.charCodeAt(i) > 127)
                    return false;
            }
            return true;
        }

        function streamGCodeReadFile()
        {
            return new Promise(function(resolve, reject)
            {
                let reader = new FileReader();
                // Closure to capture the file information.
                reader.onload = function(theFile)
                {
                    console.log(theFile.target);
                    // Check if file is GCode
                    if (gCodeCheckFileValid(theFile.target.result))
                    {
                        resolve(theFile.target.result);
                    }
                    else
                    {
                        reject(new Error("File isn't GCode"));
                    }
                };
                reader.onerror = function(err)
                {
                    reject(err);
                };
                // Read in the image file as a data URL.
                reader.readAsText(window.pageState.fileToStream);
            });
        }

        function sendLineOfGCode(gCodeLine)
        {
            return new Promise(function(resolve, reject)
            {
                let xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function()
                {
                    if (xmlhttp.readyState === 4)
                    {
                        if (xmlhttp.status === 200)
                        {
                            const respJson = xmlhttp.response;
                            if (respJson.rslt && respJson.rslt === "busy")
                            {
                                reject(xmlhttp);
                            }
                            else
                            {
                                resolve(xmlhttp);
                            }
                        }
                        else
                        {
                            reject(xmlhttp);
                        }
                    }
                };
                xmlhttp.responseType = 'json';
                xmlhttp.open("GET", '/exec/' + gCodeLine, true);
                xmlhttp.send();
            });
        }

        function gCodeCheckLineValid(gCodeLine)
        {
            gCodeLine = gCodeLine.trim();
            return (/^[GM]/.test(gCodeLine));
        }

        function gCodeStripComments(gCodeLine)
        {
            gCodeLine = gCodeLine.trim();
            gCodeLine = gCodeLine.replace(/(\(.*?\))/, "");
            return gCodeLine;
        }

        function streamGCodeSendNextChunk()
        {
            // Check if still streaming
            if (!window.pageState.streamingInProgress)
                return;
            // Find next line to send
            while (true)
            {
                let validGCodeLineFound = gCodeCheckLineValid(window.pageState.streamGcodeLines[window.pageState.streamGcodeCurLine]);
                if (validGCodeLineFound)
                    break;
                window.pageState.streamGcodeCurLine += 1;
                if (window.pageState.streamGcodeCurLine >= window.pageState.streamGcodeLines.length)
                {
                    console.log("Streaming complete");
                    setStreamGCodeState(false);
                    streamGCodeShowStatus("");
                    return;
                }
            }
            const gcodeToSend = gCodeStripComments(window.pageState.streamGcodeLines[window.pageState.streamGcodeCurLine]);
            // Send a line
            sendLineOfGCode(gcodeToSend).then(streamGCodeMoveNext, streamGCodeRetry);
        }

        function streamGCodeMoveNext()
        {
            console.log("Sent line " + window.pageState.streamGcodeCurLine + "... " + window.pageState.streamGcodeLines[window.pageState.streamGcodeCurLine]);
            window.pageState.streamGcodeRetryCount = 0;
            window.pageState.streamGcodeCurLine += 1;
            while (window.pageState.streamGcodeCurLine < window.pageState.streamGcodeLines.length)
            {
                if (window.pageState.streamGcodeLines[window.pageState.streamGcodeCurLine].trim().length === 0)
                {
                    window.pageState.streamGcodeCurLine += 1;
                    continue
                }
                streamGCodeSendNextChunk();
                return;
            }
            console.log("Streaming complete");
            setStreamGCodeState(false);
            streamGCodeShowStatus("");
        }

        function streamGCodeRetry(xmlHttpReq)
        {
            window.pageState.streamGcodeRetryCount += 1;
            console.log("Failed to send,response " + xmlHttpReq.status.toString() + "... " + xmlHttpReq.response);
            // Check status for i'm-busy codes
            if (xmlHttpReq.status === 218 || xmlHttpReq.status === 503 ||
                (xmlHttpReq.status === 200 && xmlHttpReq.response.rslt === "busy"))
            {
                if (window.pageState.streamGcodeRetryCount > window.pageState.MAX_STREAMING_RETRIES)
                {
                    console.log("Failed after " + window.pageState.MAX_STREAMING_RETRIES + " retries");
                }
                else
                {
                    window.pageState.streamGCodeRetryTimer = setTimeout(streamGCodeSendNextChunk, window.pageState.STREAMING_RETRY_TIME_MS);
                    return;
                }
            }
            else
            {
                console.log("Streaming failed, response " + xmlHttpReq.status.toString());
            }
            // No longer streaming
            setStreamGCodeState(false);
            streamGCodeShowStatus("Streaming failed")

        }

        function gcodeInputKeyPress(e)
        {
            if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13))
            {
                document.getElementById("gcodeSendButton").click();
                return false;
            }
            else
            {
                return true;
            }
        }

        function fileListUpdate()
        {
            callAjax("/filelist/", fileListUpdateOk, fileListUpdateFail)
        }

        function fileListUpdateFail()
        {
        }

        function fileSizeSI(size) {
            let e = (Math.log(size) / Math.log(1e3)) | 0;
            return +(size / Math.pow(1e3, e)).toFixed(2) + ' ' + ('kMGTPEZY'[e - 1] || '') + 'B';
        }

        function fileListUpdateOk(resp)
        {
            // Parse status received
            let fileListInfo = JSON.parse(resp);
            window.pageState.latestfileListInfo = fileListInfo;

            // Set base path
            if (fileListInfo.hasOwnProperty("fsBase"))
            {
                window.pageState.fileSystemBasePath = fileListInfo.fsBase;
            }
            // Show info
            if (fileListInfo.hasOwnProperty("diskSize"))
            {
                let fileSystemInfo = document.getElementById("file-system-info");
                let fsInfoStr = "<b>Disk Size:</b> " + fileSizeSI(fileListInfo.diskSize) + ", <b>Free Bytes:</b> " + fileSizeSI(fileListInfo.diskSize - fileListInfo.diskUsed);
                fileSystemInfo.innerHTML = fsInfoStr;
            }

            // Clear the table
            let tabFiles = document.getElementById("table_files");
            let rowCount = tabFiles.rows.length;
            for (let i = rowCount-1; i > 0; i--)
                tabFiles.deleteRow(i);

            // Add rows
            for (let i = 0; i < fileListInfo.files.length; i++)
            {
                let filename = fileListInfo.files[i].name;
                filename = filename.replace("/","");
                let filesize = fileListInfo.files[i].size;
                let row = '<tr data-file="' + filename + '">';
                row += '<td class=file-actions">'
                row += '<a class="btn btn-fileaction" onclick="deleteFile(\'' + filename + '\')">'
                row += '<svg class="icon-action"><use xlink:href="#ico-delete"></use></svg>'
                row += '</a>'
                row += '<a class="btn btn-fileaction" onclick="playFile(\'' + filename + '\')">'
                row += '<svg class="icon-action"><use xlink:href="#ico-play"></use></svg>'
                row += '</a>'
                row += '</td>'
                row += '<td class="file-name">' + filename + '</td>';
                row += '<td class="file-size hidden-xs">' + fileSizeSI(filesize) + '</td>';
                row += '</tr>';
                let newRow = tabFiles.insertRow(tabFiles.rows.length);
                newRow.innerHTML = row;
            }
        }

        function deleteFile(filename)
        {
            callAjax("/deleteFile" + window.pageState.fileSystemBasePath + "/" + filename);
            fileListUpdate();
        }

        function playFile(filename)
        {
            callAjax("/playFile" + window.pageState.fileSystemBasePath + "/" + filename);
        }

        function btnUploadToFileSystem(e)
        {
            // See if upload in progress
            if (window.pageState.streamingInProgress)
            {
                alert("Upload in progress");
                return;
            }
            window.pageState.fileDialogType = "filesystem";
            const inputFileUpload = document.getElementById("input_file_upload");
            inputFileUpload.click();
            e.preventDefault();
            // uploadFileSpecUrl("/uploadandrun", 'progress-bar-fs', file, i)
        }

        function initializeProgress(numFiles, progressBarName) {
            window.pageState.uploadProgress = []
            let progressBar = document.getElementById(progressBarName);
            progressBar.value = 0;
            for (let i = numFiles; i > 0; i--) {
                window.pageState.uploadProgress.push(0);
            }
            progressBar.display="block";
        }

        function updateProgress(fileNumber, percent, progressBarName) {
            let progressBar = document.getElementById(progressBarName);
            window.pageState.uploadProgress[fileNumber] = percent;
            let total = window.pageState.uploadProgress.reduce((tot, curr) => tot + curr, 0) / window.pageState.uploadProgress.length;
            // console.debug('update', fileNumber, percent, total);
            progressBar.value = total;
            if (progressBar.value > 99.99)
            {
                setTimeout(function(){progressBar.display="none"}, 3000);
            }
        }

        function startFileSystemUpload(files)
        {
            files = [...files]
            if (files.length <= 0)
                return;
            firstFile = files[0]
            // Get disk size
            let sizeLeft = 0;            
            if (window.pageState.hasOwnProperty("latestfileListInfo"))
            {
                if ((window.pageState.latestfileListInfo.hasOwnProperty("diskSize")) && 
                    (window.pageState.latestfileListInfo.hasOwnProperty("diskUsed")))
                    sizeLeft = window.pageState.latestfileListInfo.diskSize - window.pageState.latestfileListInfo.diskUsed;

            }
            // Check size ok
            if (firstFile.size + 1000 > sizeLeft)
            {
                alert("File is too big for storage available");
                return;
            }
            initializeProgress(files.length, 'progress-bar-file');
            files.forEach(uploadOnlyFile);
        }

        function uploadOnlyFile(file, i)
        {
            uploadFileSpecUrl("/uploadtofileman", 'progress-bar-file', file, i);
        }

        function uploadAndRunFile(file, i)
        {
            uploadFileSpecUrl("/uploadandrun", 'progress-bar-file', file, i);
        }

        function uploadFileSpecUrl(url, progressBarName, file, i) {
            var xhr = new XMLHttpRequest();
            var formData = new FormData();
            xhr.open('POST', url, true);
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');

            // Update progress (can be used to show progress indicator)
            xhr.upload.addEventListener("progress", function(e) {
                updateProgress(i, (e.loaded * 100.0 / e.total) || 100, progressBarName)
            });

            xhr.addEventListener('readystatechange', function(e) {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    updateProgress(i, 100, progressBarName)
                    fileListUpdate();
                } else if (xhr.readyState == 4 && xhr.status != 200) {
                    // Error
                }
            });

            formData.append('file', file);
            xhr.send(formData);
        }
        
    </script>

    <!-- CSS -->
    <style>
        * {
            box-sizing: border-box;
        }
        body{
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.4;
        }
        th {
            text-align: left;
            font-weight: bold;
            color: #333;
        }
        td, th {
            padding: 0;
            display: table-cell;
        }
        table {
            border-spacing: 0;
            border-collapse: collapse;
        }
        a {
            text-decoration: none;
            background-color: transparent;
            cursor: pointer;
            color: #333;
        }
        td>a {
            color: #337ab7;
        }
        progress {
            width: 100%;
            min-height:100%;
            background-color: transparent;
            border: solid 1px #f1c77c;
            border-radius: 5px;
            color: #bd7e1f;
            margin-bottom: 6px;
        }
        progress::-webkit-progress-bar {
            width: 100%;
            min-height:100%;
            background-color: transparent;
            border-color: #f1c77c;
            border-radius: 5px;
        }
        /* Firefox */
        progress::-moz-progress-bar {
            background-color: transparent;
            border-radius: 5px;
            border-color: #f1c77c;
        }
        /* Chrome */
        progress::-webkit-progress-value {
            background-color: transparent;
            border-radius: 5px;
            border-color: #f1c77c;
        }
        #container {
            display: flex;
            flex-direction: column;
        }

        .uiLineBlock {
            display: flex;
        }
        .uiBlock {
            margin: 5px;
            align-items: baseline;
            align-content: flex-start;
            justify-content: center;
            display: flex;
            flex-wrap: wrap;
        }

        .icon-connect {
            color: white;
            fill: white;
            width: 16px;
            height: 16px;
            vertical-align: middle;
        }
        .icon-action {
            color: #808080;
            fill: #808080;
            width: 16px;
            height: 16px;
            vertical-align: middle;
        }

        .btn {
            display: inline-block;
            padding: 6px 12px;
            margin-bottom: 0;
            font-size: 14px;
            font-weight: normal;
            line-height: 1.42857143;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            touch-action: manipulation;
            cursor: pointer;
            user-select: none;
            border: 1px solid transparent;
            border-radius: 4px;
            text-decoration: none;
        }

        .btn.disabled {
            cursor: not-allowed;
            opacity: .65;
        }

        .form-control {
            padding: 6px 12px;
            font-size: 14px;
            line-height: 1.42857143;
            color: #555;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
            border-radius: 4px;
            -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
            vertical-align: middle;
        }

        .btn-action {
            color: white;
            background-color: #dea352;
            border-color: #bd7e1f;
        }

        .btn-default {
            color: #333;
            text-shadow: 0 1px 0 #fff;
            background-image: -webkit-linear-gradient(top, #fff 0%, #e0e0e0 100%);
            background-image: -o-linear-gradient(top, #fff 0%, #e0e0e0 100%);
            background-image: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#e0e0e0));
            background-image: linear-gradient(to bottom, #fff 0%, #e0e0e0 100%);
            background-repeat: repeat-x;
            border-color: #ccc;
        }

        .btn-fileaction {
            padding: 0 5px;
        }

        .btn-primary {
            color: white;
            background-image: linear-gradient(to bottom, #e4af43 0, #dc7410 100%);
            background-repeat: repeat-x;
            border-color: #bd7e1f;
        }

        .btn-heading {
            color: white;
            background-image: linear-gradient(to bottom, #e4af43 0, #dc7410 100%);
            background-repeat: repeat-x;
            border-color: #bd7e1f;
            float:right;
            padding: 2px 12px;
            margin: -4px;
        }
        /*.btn-heading:after {*/
            /*content: "";*/
            /*clear: both;*/
            /*display: table;*/
        /*}*/
        .btn-clear {
            content: "";
            clear: both;
            display: table;
        }

        .btn-default.disabled {
            background-color: #e0e0e0;
            background-image: none;
        }

        .uiPanel {
            display: block;
            min-height: 1px;
            background-color: #fff;
            border: 1px solid #f1c77c;
            border-radius: 4px;
        }

        .uiPanelHead {
            background-image: linear-gradient(to bottom, #f7f0b9 0%, #f3ba64 100%);
            background-repeat: repeat-x;
            color: #8f3800;
            background-color: #f7dd6f;
            border-color: #f1c77c;
            padding: 10px 10px 10px 10px;
            border-bottom: 1px solid transparent;
            border-top-left-radius: 3px;
            border-top-right-radius: 3px;
        }
        
        .uiPanelMovement {

        }
        .uiTable {
            border: 0;
            width: 100%;
            max-width: 100%;
            border-spacing: 0;
            border-collapse: collapse;
            background-color: transparent;
            text-align: center;
            vertical-align: middle !important;
        }
        .uiTable>thead>tr>th {
            vertical-align: bottom;
            border-bottom: 2px solid #ddd;
        }
        .uiTable>thead>tr>th, .uiTable>tbody>tr>th, .uiTable>tfoot>tr>th, .uiTable>thead>tr>td, .uiTable>tbody>tr>td, .uiTable>tfoot>tr>td {
            padding: 8px;
            line-height: 1.42857143;
            vertical-align: center;
            border-top: 1px solid #ddd;
        }
        .uiTable>caption+thead>tr:first-child>th, .uiTable>colgroup+thead>tr:first-child>th, .uiTable>thead:first-child>tr:first-child>th, .uiTable>caption+thead>tr:first-child>td, .uiTable>colgroup+thead>tr:first-child>td, .uiTable>thead:first-child>tr:first-child>td {
            border-top: 0;
        }
        .uiTableBordered>thead>tr>th, .uiTableBordered>tbody>tr>th, .uiTableBordered>tfoot>tr>th, .uiTableBordered>thead>tr>td, .uiTableBordered>tbody>tr>td, .uiTableBordered>tfoot>tr>td {
            border: 1px solid #ddd;
        }
        .uiTableBordered>thead>tr>th, .table-bordered>thead>tr>td {
            border-bottom-width: 2px;
        }
        .uiTableBordered {
            border: 1px solid #ddd;
            vertical-align: center;
        }
        .uiTableFiles {
            margin-bottom: 15px;
            min-width: 700px;
        }

        .uiTableLeftAligned {
            text-align: left;
        }
        .uiTableGrid > tbody > tr > th, .uiTableGrid > tbody > tr > td {
            border: 1px solid #ddd;
            min-width: 60px;
            padding:5px;
        }
        .uiTableSettings {
            min-width: 700px;
        }
        .uiTableStatus {
            min-width: 335px;
            min-height: 394px;
        }
        .uiTableStatus td {
            font-size:1.1rem;
        }
        .th-statusGrid {
            width: 100px;
            font-weight: normal;
        }

        .uiTableButtons {
            margin-top: 10px;
        }
        .uiTableButtons > tbody > tr {
            padding-botton: 10px;
        }
        .uiTableButtons > tbody > tr > th, .uiTableButtons > tbody > tr > td {
            border: none;
            padding-left: 6px;
            padding-right: 6px;
        }

        .btn-group {
            padding-bottom: 9px;
                position: relative;
            display: inline-block;
            vertical-align: middle;
            width: auto;
        }
        .btn-group-justified {
            display: table;
            width: 350px;
            table-layout: fixed;
            border-collapse: separate;
            margin: 0 2px;
        }
        .btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .btn-group > .btn:first-child {
            margin-left: 0;
        }
        .btn-group-justified>.btn, .btn-group-justified>.btn-group {
            display: table-cell;
            float: none;
            width: 1%;
        }
        .txt-status {

        }
        .extra-space-above {
            margin-top: 7px;
        }
        .textAreaInput {
            border: none;
            width:100%;
            height:100%;
            min-height: 8rem;
            min-width: 20rem;
        }
        .textAreaOneLine {
            border: none;
            width:100%;
            height:100%;
        }
        .hidden {
            visibility: hidden;
        }

    </style>

</head>

<body onload="bodyIsLoaded(event)">
    <!-- Master layout -->
    <div id="container">
        <div class="uiLineBlock">
            <div class="uiBlock">
                <button type="button" id="button-connect" class="btn btn-action" onclick="reconnect(event)">
                    <svg class="icon-connect">
                        <use xlink:href = "#icon-log-in"></use>
                    </svg>
                    <span>Connect</span>
                </button>
            </div>
            <div class="uiBlock">
                <div class="uiForm">
                    <input type="text" name="gcode" class="form-control" onkeypress="gcodeInputKeyPress" placeholder="G-Code ..." id="gcodeSendBox">
                    <button type="submit" id="gcodeSendButton" class="btn btn-default" title="Send G-Code" onclick="sendGcodeFromInput(event)">
                        <svg class="icon-action">
                            <use xlink:href="#icon-send"></use>
                        </svg>
                        <span>Send</span>
                    </button>
                </div>
            </div>

            <div class="uiBlock">
                <div class="uiForm">
                    <button id="btnStreamGCode" class="btn btn-default" title="Stream a G-Code file" onclick="btnStreamGcode(event)" >
                        <svg class="icon-action">
                            <use xlink:href="#icon-upload"></use>
                        </svg>
                        <span>Stream</span>
                    </button>
                    <span id="txtUploadStatus" class="txt-status"></span>
                    <button id="btnStreamGCodeCancel" class="btn btn-default disabled" title="Cancel upload" onclick="btnStreamGCodeCancel(event)" disabled >
                        <svg class="icon-action">
                            <use xlink:href="#ico-cncl"></use>
                        </svg>
                        <span>Cancel</span>
                    </button>
                </div>
            </div>

            <div class="uiBlock">
                <div class="uiForm">
                    <button type="button" class="btn btn-action" onclick="pauseRobot(event)">
                        <svg class="icon-connect">
                            <use xlink:href = "#ico-pause"></use>
                        </svg>
                        <span>Pause</span>
                    </button>
                    <button type="button" class="btn btn-action" onclick="resumeRobot(event)">
                        <svg class="icon-connect">
                            <use xlink:href = "#ico-play"></use>
                        </svg>
                        <span>Resume</span>
                    </button>
                    <button type="button" class="btn btn-action" onclick="stopRobot(event)">
                        <svg class="icon-connect">
                            <use xlink:href = "#ico-stop"></use>
                        </svg>
                        <span>Stop</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="uiLineBlock">
            <div class="uiBlock">
                <div class="uiPanel uiPanelMovement">
                    <div class="uiPanelHead">
                        <span>Movement</span>
                    </div>
                    <div class="uiTable uiTblBtns tableMovement">
                        <tr>
                            <td class="home-buttons visible-lg">
                                <div class="btn-group extra-space-above" role="group">
                                    <button class="btn btn-primary" title="Home All (G28)" onclick="goHomeClick(-1)">
                                        <span>Home All</span>
                                    </button>
                                    <button class="btn btn-primary" title="Home X axis (G28 X)" onclick="goHomeClick(0)">
                                        <span>Go Home X</span>
                                    </button>
                                    <button class="btn btn-primary" title="Home X axis (G92 X)" onclick="setHomeClick(0)">
                                        <span>Set Home X</span>
                                    </button>
                                </div>
                            </td>
                            <td>
                                <div class="btn-group btn-group-justified" role="group">
                                    <a class="btn btn-default" onclick="moveClick(0,-100)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>X-100</span>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(0,-10)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>X-10</span>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(0,-1)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>X-1</span>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(0,-0.1)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>X-0.1</span>
                                    </a>
                                </div>
                            </td>
                            <td>
                                <div class="btn-group btn-group-justified" role="group">
                                    <a class="btn btn-default" onclick="moveClick(0,0.1)">
                                        <span>X+0.1</span>
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(0,1)">
                                        <span>X+1</span>
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(0,10)">
                                        <span>X+10</span>
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(0,100)">
                                        <span>X+100</span>

                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="home-buttons visible-lg">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-primary" title="Home Y axis (G28 Y)" onclick="goHomeClick(1)">
                                        <span>Go Home Y</span>
                                    </button>
                                    <button class="btn btn-primary" title="Home Y axis (G92 Y)" onclick="setHomeClick(1)">
                                        <span>Set Home Y</span>
                                    </button>
                                </div>
                            </td>
                            <td>
                                <div class="btn-group btn-group-justified" role="group">
                                    <a class="btn btn-default" onclick="moveClick(1,-100)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>Y-100</span>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(1,-10)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>Y-10</span>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(1,-1)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>Y-1</span>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(1,-0.1)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>Y-0.1</span>
                                    </a>
                                </div>
                            </td>
                            <td>
                                <div class="btn-group btn-group-justified" role="group">
                                    <a class="btn btn-default" onclick="moveClick(1,0.1)">
                                        <span>Y+0.1</span>
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(1,1)">
                                        <span>Y+1</span>
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(1,10)">
                                        <span>Y+10</span>
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(1,100)">
                                        <span>Y+100</span>

                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="home-buttons visible-lg">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-primary" title="Home Z axis (G28 Z)" onclick="goHomeClick(2)">
                                        <span>Go Home Z</span>
                                    </button>
                                    <button class="btn btn-primary" title="Home Z axis (G92 Z)" onclick="setHomeClick(2)">
                                        <span>Set Home Z</span>
                                    </button>
                                </div>
                            </td>
                            <td>
                                <div class="btn-group btn-group-justified" role="group">
                                    <a class="btn btn-default" onclick="moveClick(2,-100)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>Z-100</span>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(2,-10)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>Z-10</span>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(2,-1)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>Z-1</span>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(2,-0.1)">
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-lc"></use>
                                        </svg>
                                        <span>Z-0.1</span>
                                    </a>
                                </div>
                            </td>
                            <td>
                                <div class="btn-group btn-group-justified" role="group">
                                    <a class="btn btn-default" onclick="moveClick(2,0.1)">
                                        <span>Z+0.1</span>
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(2,1)">
                                        <span>Z+1</span>
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(2,10)">
                                        <span>Z+10</span>
                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                    <a class="btn btn-default" onclick="moveClick(2,100)">
                                        <span>Z+100</span>

                                        <svg class="icon-action">
                                            <use xlink:href="#ico-rc"></use>
                                        </svg>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </div>
                </div>
            </div>
            <div class="uiBlock">
                <div class="uiPanel">
                    <div class="uiPanelHead">
                        <span>Status</span>
                    </div>
                    <table class="uiTable uiTableGrid uiTableStatus">
                        <tbody>
                        <tr>
                            <th class="th-status"></th>
                            <th id="th_X">X</th>
                            <th id="th_Y">Y</th>
                            <th id="th_Z" style="border-right: 1px;">Z</th>
                        </tr>
                        <tr>
                            <th class="th-status">Position</th>
                            <td id="td_X">n/a</td>
                            <td id="td_Y">n/a</td>
                            <td id="td_Z" style="border-right: 1px;">n/a</td>
                        </tr>
                        <tr>
                            <th class="th-status">Steps</th>
                            <td id="td_stepX">n/a</td>
                            <td id="td_stepY">n/a</td>
                            <td id="td_stepZ" style="border-right: 1px;">n/a</td>
                        </tr>
                        <tr>
                            <th class="th-status">Min-stop</th>
                            <td id="td_minX">n/a</td>
                            <td id="td_minY">n/a</td>
                            <td id="td_minZ" style="border-right: 1px;">n/a</td>
                        </tr>
                        <tr>
                            <th class="th-status">Max-stop</th>
                            <td id="td_maxX">n/a</td>
                            <td id="td_maxY">n/a</td>
                            <td id="td_maxZ" style="border-right: 1px;">n/a</td>
                        </tr>
                        <tr>
                            <th class="th-status">State</th>
                            <td id="td_robotState" colspan="3" style="border-right: 1px;"></td>
                        </tr>
                        <tr>
                            <th class="th-status">QueueLen</th>
                            <td id="td_robotQueueLen" colspan="3" style="border-right: 1px;"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="uiLineBlock">
            <div class="uiBlock">
                <div class="uiPanel file-upload-form">
                    <div class="uiPanelHead">
                        <span>Files</span>
                        <button id="btnUploadFileList" class="btn btn-heading" title="Upload" onclick="btnUploadToFileSystem(event)">
                            <span>Upload</span>
                        </button>
                        <div class="btn-clear"></div>
                    </div>
                    <div id="file-system-info" class="uiPanelSub"><span></span></div>
                    <progress class="progress-file" id="progress-bar-file" max=100 value=20 style="display: none;"></progress>
                    <table class="uiTable uiTableBordered uiTableFiles uiTableStripe" id="table_files">
                        <thead>
                            <tr>
                                <th><a href="#" data-attribute="action">Actions</a>
                                </th>
                                <th><a href="#" data-attribute="filename">File Name</a>
                                </th>
                                <th><a href="#" data-attribute="size">Size</a>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="uiLineBlock">
            <div class="uiBlock">
                <div class="uiPanel">
                    <div class="uiPanelHead">
                        <span>Settings</span>
                        <button id="btnSaveConfig" class="btn btn-heading" title="Save" onclick="saveConfig()">
                            <span>Save</span>
                        </button>
                        <div class="btn-clear"></div>
                    </div>
                    <table class="uiTable uiTableGrid uiTableLeftAligned uiTableSettings">
                        <tbody>
                        <tr>
                            <th class="th-status">RobotName</th>
                            <td id="td_RobotName" style="border-right: 1px;">
                                <textarea class="textAreaOneLine" id="td_RobotName_input"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <th class="th-status">RobotConfig</th>
                            <td id="td_RobotConfig" style="border-right: 1px;">
                                <textarea class="textAreaInput" id="td_RobotConfig_input"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <th class="th-status">Schedule</th>
                            <td id="td_CmdSchedule" style="border-right: 1px;">
                                <textarea class="textAreaInput" id="td_CmdSchedule_input"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <th class="th-status">Change RobotType</th>
                            <td id="td_RobotType" style="border-right: 1px;">
                                <select id="td_RobotTypeSelect">
                                </select>
                                <button id="td_RobotTypeClick" onclick="robotTypeClick()">Set</button>
                                <div>Click Save to confirm changes</div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- SVG icons -->
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
		 xml:space="preserve">
        <symbol id="icon-log-in" viewBox="0 0 1200 1200">
            <g>
                <path d="M550 1100h400q165 0 257.5 -92.5t92.5 -257.5v-400q0 -165 -92.5 -257.5t-257.5 -92.5h-400q-21 0 -35.5 14.5t-14.5 35.5v100q0 21 14.5 35.5t35.5 14.5h450q41 0 70.5 29.5t29.5 70.5v500q0 41 -29.5 70.5t-70.5 29.5h-450q-21 0 -35.5 14.5t-14.5 35.5v100 q0 21 14.5 35.5t35.5 14.5zM338 867l324 -284q16 -14 16 -33t-16 -33l-324 -284q-16 -14 -27 -9t-11 26v150h-250q-21 0 -35.5 14.5t-14.5 35.5v200q0 21 14.5 35.5t35.5 14.5h250v150q0 21 11 26t27 -9z"></path>
            </g>
        </symbol>
        <symbol id="icon-send" viewBox="0 0 1200 1200" >
            <g>
                <path d="M1200 103l-483 276l-314 -399v423h-399l1196 796v-1096zM483 424v-230l683 953z"
                      transform="scale(1,-1) translate(0,-1200)"></path>
            </g>
        </symbol>
        <symbol id="ico-lc" viewBox="0 0 1200 1200">
            <g>
                <path d="M885 900l-352 -353l352 -353l-197 -198l-552 552l552 550z"></path>
            </g>
        </symbol>
        <symbol id="ico-rc" viewBox="0 0 1200 1200">
            <g>
                <path d="M1064 547l-551 -551l-198 198l353 353l-353 353l198 198z"></path>
            </g>
        </symbol>
        <symbol id="icon-upload" viewBox="0 0 1200 1200">
            <g>
                <path d="M502 1089q110 0 201 -59.5t135 -156.5q43 15 89 15q121 0 206 -86.5t86 -206.5q0 -99 -60 -181t-150 -110l-378
                 360q-13 16 -31.5 16t-31.5 -16l-381 -365h-9q-79 0 -135.5 57.5t-56.5 136.5q0 69 43 122.5t108 67.5q-2 19 -2 38q0 100
                 49 184.5t133.5 134t184.5 49.5z M632 467l223 -228q13 -16 8 -27.5t-26 -11.5h-137v-275q0 -10 -7.5 -17.5t-17.5
                 -7.5h-150q-10 0 -17.5 7.5t-7.5 17.5v275h-137q-21 0 -26 11.5t8 27.5q199 204 223 228q19 19 31.5 19t32.5 -19z"
                 transform="scale(1,-1) translate(0,-1100)"></path>
            </g>
        </symbol>
        <symbol id="ico-cncl" viewBox="0 0 510 510">
            <g>
                <path d="M255,0C114.75,0,0,114.75,0,255s114.75,255,255,255s255-114.75,255-255S395.25,0,255,0z M382.5,346.8l-35.7,35.7
			L255,290.7l-91.8,91.8l-35.7-35.7l91.8-91.8l-91.8-91.8l35.7-35.7l91.8,91.8l91.8-91.8l35.7,35.7L290.7,255L382.5,346.8z"></path>
            </g>
        </symbol>
        <symbol id="ico-stop" viewBox="0 0 191 191">
            <g>
                <path d="M158.912,0H31.782C14.239,0,0,14.239,0,31.782v127.13c0,17.544,14.239,31.782,31.782,31.782
				h127.13c17.544,0,31.782-14.239,31.782-31.782V31.782C190.695,14.239,176.456,0,158.912,0z"></path>
            </g>
        </symbol>
        <symbol id="ico-pause" viewBox="0 0 46 46">
            <g>
                <path d="M13.987,0c-2.762,0-5,2.239-5,5v35.975c0,2.763,2.238,5,5,5s5-2.238,5-5V5C18.987,2.238,16.75,0,13.987,0z"/>
                <path d="M31.987,0c-2.762,0-5,2.239-5,5v35.975c0,2.762,2.238,5,5,5s5-2.238,5-5V5C36.987,2.239,34.749,0,31.987,0z"/>
            </g>
        </symbol>
        <symbol id="ico-play" viewBox="0 0 233 233">
            <g>
                <path d="M203.791,99.628L49.307,2.294c-4.567-2.719-10.238-2.266-14.521-2.266
		c-17.132,0-17.056,13.227-17.056,16.578v198.94c0,2.833-0.075,16.579,17.056,16.579c4.283,0,9.955,0.451,14.521-2.267
		l154.483-97.333c12.68-7.545,10.489-16.449,10.489-16.449S216.471,107.172,203.791,99.628z"/>
            </g>
        </symbol>
        <symbol id="ico-delete" viewBox="0 0 26 26">
            <g>
                <path d="M 11 -0.03125 C 10.164063 -0.03125 9.34375 0.132813 8.75 0.71875 C 8.15625 1.304688 7.96875 2.136719 7.96875 3 L 4 3 C 3.449219 3 3 3.449219 3 4 L 2 4 L 2 6 L 24 6 L 24 4 L 23 4 C 23 3.449219 22.550781 3 22 3 L 18.03125 3 C 18.03125 2.136719 17.84375 1.304688 17.25 0.71875 C 16.65625 0.132813 15.835938 -0.03125 15 -0.03125 Z M 11 2.03125 L 15 2.03125 C 15.546875 2.03125 15.71875 2.160156 15.78125 2.21875 C 15.84375 2.277344 15.96875 2.441406 15.96875 3 L 10.03125 3 C 10.03125 2.441406 10.15625 2.277344 10.21875 2.21875 C 10.28125 2.160156 10.453125 2.03125 11 2.03125 Z M 4 7 L 4 23 C 4 24.652344 5.347656 26 7 26 L 19 26 C 20.652344 26 22 24.652344 22 23 L 22 7 Z M 8 10 L 10 10 L 10 22 L 8 22 Z M 12 10 L 14 10 L 14 22 L 12 22 Z M 16 10 L 18 10 L 18 22 L 16 22 Z "/>
            </g>
        </symbol>
    </svg>

    <!-- Modal dialogs -->
    <input type="file" id="input_file_upload" class="hidden">

</body>
</html>
